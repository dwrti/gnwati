<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ù…ØªØ²Ø§Ù…Ù† ðŸ“º</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        video { width: 100%; height: 100vh; background: #000; }
    </style>
</head>
<body>

    <video id="player" controls autoplay playsinline></video>

    <script>
        const v = document.getElementById('player');
        let hls = new Hls(), lastUrl = "", db = "https://axnt-68677-default-rtdb.europe-west1.firebasedatabase.app/live_stream.json";

        function play(url) {
            if (!url || url === lastUrl) return;
            lastUrl = url;
            if (Hls.isSupported() && url.includes('m3u8')) {
                hls.destroy(); hls = new Hls();
                hls.loadSource(url); hls.attachMedia(v);
            } else { v.src = url; }
            v.play().catch(() => { v.muted = true; v.play(); });
        }

        async function sync() {
            try {
                const res = await fetch(db + "?nocache=" + Date.now());
                const data = await res.json();
                if (!data || data.syncEnabled === false) return;

                play(data.url);

                // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙØ§Ø±Ù‚ ÙƒØ¨ÙŠØ±Ø§Ù‹ (Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø«ÙˆØ§Ù†Ù)
                if (Math.abs(v.currentTime - data.time) > 3) {
                    v.currentTime = data.time;
                }

                // Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙˆÙ‚Ù: Ù„Ø§ Ù†Ø±Ø³Ù„ Ø£Ù…Ø± ØªØ´ØºÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù‚Ø·Ø¹ ÙŠØ¹Ù…Ù„ Ø£ØµÙ„Ø§Ù‹
                if (data.status === "playing" && v.paused) {
                    v.play().catch(() => {});
                } else if (data.status === "paused" && !v.paused) {
                    v.pause();
                }
            } catch (e) {}
        }

        setInterval(sync, 2000);
        document.body.onclick = () => { if(v.muted) v.muted = false; };
    </script>
</body>
</html>
