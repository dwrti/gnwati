<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل متزامن</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        video { width: 100%; height: 100%; outline: none; }
    </style>
</head>
<body>

    <video id="v" controls autoplay playsinline></video>

    <script>
        var v = document.getElementById('v'), h = new Hls(), last = "",
            db = "https://axnt-68677-default-rtdb.europe-west1.firebasedatabase.app/live_stream.json";

        function sync() {
            fetch(db).then(r => r.json()).then(data => {
                if (!data || data.syncEnabled === false) return;

                // تحديث الرابط
                if (data.url !== last) {
                    last = data.url;
                    if (Hls.isSupported() && (last.includes('m3u8'))) {
                        h.destroy(); h = new Hls(); h.loadSource(last); h.attachMedia(v);
                    } else { v.src = last; }
                }

                // مزامنة الوقت (فرق أكثر من 2 ثانية)
                if (Math.abs(v.currentTime - data.time) > 2) v.currentTime = data.time;

                // حالة التشغيل
                if (data.status === "playing" && v.paused) v.play().catch(() => { v.muted = true; v.play(); });
                else if (data.status === "paused" && !v.paused) v.pause();
            });
        }

        // تحديث كل ثانيتين
        setInterval(sync, 2000);
        sync();
    </script>
</body>
</html>
