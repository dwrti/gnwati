<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø´ØºÙ„ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒØ§Ù…Ù„ ğŸ“º</title>
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        /* ØªØµÙ…ÙŠÙ… ÙŠØ±ÙƒØ² Ø¹Ù„Ù‰ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙÙ‚Ø· */
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background-color: #000; overflow: hidden; 
        }

        #videoContainer {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }

        video { 
            width: 100%; 
            height: 100%; 
            object-fit: contain; /* ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø£ØµÙ„ÙŠ */
        }

        /* Ø±Ø³Ø§Ù„Ø© ØªÙˆØ¶ÙŠØ­ÙŠØ© ØªØ®ØªÙÙŠ */
        #overlay {
            position: absolute; top: 10px; left: 10px;
            background: rgba(0,0,0,0.5); color: #fff;
            padding: 5px 10px; border-radius: 5px; font-size: 12px;
            pointer-events: none; z-index: 10;
        }
    </style>
</head>
<body onclick="forceFullscreen()">

    <div id="overlay">ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù†Ø´Ø· (ØµØ§Ù…Øª) ğŸ”’</div>

    <div id="videoContainer">
        <video id="myPlayer" autoplay playsinline muted></video>
    </div>

    <script>
        var videoElement = document.getElementById('myPlayer');
        var hls = new Hls();
        var dbUrl = "https://axnt-68677-default-rtdb.europe-west1.firebasedatabase.app/live_stream.json";
        var lastUrl = ""; 
        var isAdmin = window.location.hash === "#ana";

        // ÙˆØ¸ÙŠÙØ© Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ
        function forceFullscreen() {
            var elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) { /* Safari */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE11 */
                elem.msRequestFullscreen();
            }
            // Ø¥Ø°Ø§ Ø£Ø±Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ø¶ØºØ·Ø©
            // videoElement.muted = false; 
        }

        function playMedia(url) {
            if (!url) { 
                videoElement.src = ""; 
                if (hls) hls.destroy(); 
                lastUrl = ""; 
                return; 
            }
            if (url === lastUrl) return;
            lastUrl = url;

            if (Hls.isSupported() && (url.includes('m3u8') || url.includes('.ts'))) {
                hls.destroy(); 
                hls = new Hls();
                hls.loadSource(url); 
                hls.attachMedia(videoElement);
            } else { 
                videoElement.src = url; 
            }
            
            // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ ØµØ§Ù…ØªØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ù‚Ø¨ÙˆÙ„
            videoElement.muted = true;
            videoElement.play().catch(e => console.log("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ:", e));
        }

        function syncPlayer(data) {
            if (!data) return;
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
            if (data.url !== lastUrl) {
                playMedia(data.url);
            }
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª (ÙØ§Ø±Ù‚ Ø«Ø§Ù†ÙŠØ© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„ØªØµØ­ÙŠØ­)
            var timeDiff = Math.abs(videoElement.currentTime - data.time);
            if (timeDiff > 1.5) {
                videoElement.currentTime = data.time;
            }
            
            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ø§Ù„Ø© (ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù)
            if (data.status === "playing" && videoElement.paused) {
                videoElement.play();
            } else if (data.status === "paused" && !videoElement.paused) {
                videoElement.pause();
            }
        }

        function loadStream() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", dbUrl, true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    syncPlayer(data);
                }
            };
            xhr.send();
        }

        // ØªØ­Ø¯ÙŠØ« Ù„Ø­Ø¸ÙŠ ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© Ù„Ø¬Ø¹Ù„Ù‡Ø§ "Ù…Ø²Ø§Ù…Ù†Ø© Ù„Ø­Ø¸ÙŠØ©" ÙØ¹Ù„Ø§Ù‹
        setInterval(loadStream, 1000);

        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ø£Ø¯Ù…Ù†ØŒ Ù†Ø±Ø³Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù„Ù„Ù‚Ø§Ø¹Ø¯Ø©
        if (isAdmin) {
            videoElement.muted = false; // Ø§Ù„Ø£Ø¯Ù…Ù† ØºØ§Ù„Ø¨Ø§Ù‹ ÙŠØ­ØªØ§Ø¬ Ø§Ù„ØµÙˆØª
            setInterval(function() {
                var xhr = new XMLHttpRequest();
                xhr.open("PATCH", dbUrl, true);
                var state = { 
                    status: videoElement.paused ? "paused" : "playing", 
                    time: videoElement.currentTime 
                };
                xhr.send(JSON.stringify(state));
            }, 2000);
        }

        window.onload = loadStream;
    </script>
</body>
</html>
